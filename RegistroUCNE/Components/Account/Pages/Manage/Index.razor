@page "/Account/Manage"

@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Identity
@using RegistroUCNE.Data

@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager
@inject IdentityRedirectManager RedirectManager

<PageTitle>Perfil</PageTitle>

<h3>Perfil</h3>
<StatusMessage />

<div class="row">
    <div class="col-xl-6">

        <div class="form-floating mb-3">
            <input type="text" value="@username" id="username" class="form-control" disabled />
            <label for="username">Usuario</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" value="@email" id="email" class="form-control" disabled />
            <label for="email">Correo electrónico</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" value="@phoneNumber" id="phoneNumber" class="form-control" disabled />
            <label for="phoneNumber">Teléfono</label>
        </div>

    </div>

    <div class="col-xl-6">

        <div class="form-floating mb-3">
            <input type="text" value="@nombres" id="nombres" class="form-control" disabled />
            <label for="nombres">Nombres</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" value="@apellidos" id="apellidos" class="form-control" disabled />
            <label for="apellidos">Apellidos</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" value="@direccion" id="direccion" class="form-control" disabled />
            <label for="direccion">Dirección</label>
        </div>

    </div>
</div>

@code {
    private ApplicationUser? user;
    private string? username;
    private string? email;
    private string? phoneNumber;
    private string? nombres;
    private string? apellidos;
    private string? direccion;

    [CascadingParameter]
    private HttpContext HttpContext { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        user = await UserManager.GetUserAsync(HttpContext.User);
        if (user is null)
        {
            RedirectManager.RedirectToInvalidUser(UserManager, HttpContext);
            return;
        }

        username = await UserManager.GetUserNameAsync(user);
        email = await UserManager.GetEmailAsync(user);
        phoneNumber = await UserManager.GetPhoneNumberAsync(user);

        nombres = user.Nombres;
        apellidos = user.Apellidos;
        direccion = user.Direccion;
    }
}
